<p-toast [position]="'top-right'"></p-toast>
<form name="form" (ngSubmit)="onUpdateUser(fup)" #fup="ngForm" novalidate *ngIf="!authService.isAdmin()">
    <div class="m-auto w-7 max-h-screen overflow-auto">
            <div class="flex flex-wrap gap-2 justify-content-center mb-2 ">
                <!-- <div>
                    <label for="email" class="block text-900 font-medium mb-2">Email</label>
                    <input ngModel name="email" id="email" type="email" #email="ngModel" [(ngModel)]="data.user.email" pInputText class="w-full mb-3" required email="true">
                </div>
                <div>
                    <label for="password" class="block text-900 font-medium mb-2">Password</label>
                    <input ngModel id="password" name="password" type="password" pInputText class="w-full mb-3" [ngClass]="{ 'is-invalid': fup.submitted && name.invalid }" #name="ngModel" [(ngModel)]="data.user.password" required>
                </div> -->
                <div *ngIf="type == 'patient'">
                    <label for="firstName" class="block text-900 font-medium mb-2">First Name <span class="text-red-500">*</span></label>
                    <input ngModel id="firstName" type="text" name="first_name" pInputText class="w-full mb-3" [ngClass]="{ 'is-invalid': fup.submitted && first_name.invalid }" #first_name="ngModel" [(ngModel)]="data.first_name" required>
                </div>
                <div *ngIf="type == 'patient'">
                    <label for="lastName" class="block text-900 font-medium mb-2">Last Name <span class="text-red-500">*</span></label>
                    <input ngModel id="lastName" type="text" name="last_name" pInputText class="w-full mb-3" [ngClass]="{ 'is-invalid': fup.submitted && last_name.invalid }" #last_name="ngModel" [(ngModel)]="data.last_name" required>
                </div>
                <div *ngIf="type == 'patient'">
                    <label for="gender" class="block text-900 font-medium mb-2">Gender <span class="text-red-500">*</span></label>
                    <p-dropdown ngModel inputId="dropdown" name="gender" [options]="genders" optionLabel="name" optionValue="code" [(ngModel)]="data.gender" placeholder="Gender" [ngClass]="{ 'is-invalid': fup.submitted && gender.invalid }" #gender="ngModel"></p-dropdown>
                </div>
                <div *ngIf="type == 'doctor'">
                    <label for="name" class="block text-900 font-medium mb-2">Full Name <span class="text-red-500">*</span></label>
                    <input ngModel id="name" type="text" name="name" pInputText class="w-full mb-3" [ngClass]="{ 'is-invalid': fup.submitted && name.invalid }" #name="ngModel" [(ngModel)]="data.name" required>
                </div>
                <div *ngIf="type == 'doctor'">
                    <label for="speciality" class="block text-900 font-medium mb-2">Speciality <span class="text-red-500">*</span></label>
                    <input  ngModel id="speciality" type="text" name="speciality" pInputText class="w-full mb-3" [ngClass]="{ 'is-invalid': fup.submitted && speciality.invalid }" #speciality="ngModel" [(ngModel)]="data.speciality" required>
                </div>
                <div *ngIf="type == 'doctor'">
                    <label for="degree" class="block text-900 font-medium mb-2">Degree <span class="text-red-500">*</span></label>
                    <input id="degree" ngModel type="text" name="degree" pInputText class="w-full mb-3" [ngClass]="{ 'is-invalid': fup.submitted && degree.invalid }" #degree="ngModel" [(ngModel)]="data.degree" required>
                </div>
                <div class="field col-12 p-0 md:col-4">
                    <label for="dateOfBirth" class="block text-900 font-medium mb-2">Date Of Birth <span class="text-red-500">*</span></label>
                    <p-calendar name="dateOfBirth" ngModel id="dateOfBirth" [showIcon]="true" inputId="icon" [ngClass]="{ 'is-invalid': fup.submitted && dateOfBirth.invalid }" #dateOfBirth="ngModel" [(ngModel)]="data.dateOfBirth" [required]="true" [style]="{'width':'100%'}" [inputStyle]="{'width':'100%'}"></p-calendar>
                </div>
                <div>
                    <label for="address" class="block text-900 font-medium mb-2">Address <span class="text-red-500">*</span></label>
                    <input ngModel id="address" type="text" name="address" pInputText class="w-full mb-3" [ngClass]="{ 'is-invalid': fup.submitted && name.invalid }" #name="ngModel" [(ngModel)]="data.address" required>
                </div>
                <div>
                    <label for="phone" class="block text-900 font-medium mb-2">Phone <span class="text-red-500">*</span></label>
                    <input ngModel id="phone" type="number" pInputText name="phone" class="w-full mb-3" [ngClass]="{ 'is-invalid': fup.submitted && phone.invalid }" #phone="ngModel" [(ngModel)]="data.phone" required>
                </div>
                <div>
                    <label for="avatar" class="block text-900 font-medium mb-2">Photo</label>
                    <p-fileUpload name="avatar" [customUpload]="true" (uploadHandler)="onBasicUpload($event)" [ngClass]="{ 'is-invalid': fup.submitted && name.invalid }" [auto]="true"></p-fileUpload>
                </div>
            </div>
            <div class="flex justify-content-center align-items-center">
                <button pButton pRipple label="Update" icon="pi pi-user" class="w-6" type="submit" [disabled]="fup.invalid"></button>
            </div>
        </div>    
    </form>

    <p-table [value]="items" *ngIf="authService.isAdmin()">
        <ng-template pTemplate="header">
            <tr>
                <th>Email</th>
                <th>Password</th>
                <th>Role</th>
                <th>Action</th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-item let-i>
            <tr>
                <!-- <td *ngIf="isDoctor">
                    <img src="http://localhost:3000/{{item.patient_id.image}}" width="32" height="32" style="vertical-align: middle; border-radius: 50%;"  />
                    {{item.patient_id.first_name}} {{item.patient_id.last_name}}
                </td>
                <td *ngIf="isPatient">
                    <img src="http://localhost:3000/{{item.doctor_id.image}}" width="32" height="32" style="vertical-align: middle; border-radius: 50%;"  />
                    {{item.doctor_id.name}}
                </td> -->
                <td>{{item.email}}</td>
                <td>{{item.password}}</td>
                <td *ngIf="item.role == 0">Doctor</td>
                <td *ngIf="item.role == 1">Patient</td>
                <td *ngIf="item.role == 2">Admin</td>
                <!-- <td><span class="border-round p-1 text-white appointment-status {{item.status}}">{{item.status}}</span></td> -->
                <td class="flex justify-content-evenly">
                    <button pButton pRipple type="button" icon="pi pi-eye" class="p-button-rounded" (click)="triggerDialog(item,'details')"></button>
                    <button pButton pRipple type="button" icon="pi pi-pencil" class="p-button-rounded" (click)="triggerDialog(item, 'update')"></button>
                    <button pButton pRipple type="button" icon="pi pi-trash" class="p-button-rounded" (click)="triggerDialog(item,'cancel')"></button>
                </td>
            </tr>
        </ng-template>
    </p-table>
